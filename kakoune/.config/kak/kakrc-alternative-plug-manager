evaluate-commands %sh{
    plugins="$kak_config/plugins"
    mkdir -p "$plugins"
    [ ! -e "$plugins/plug.kak" ] && \ 
        git clone -q https://github.com/andreyorst/plug.kak.git "$plugins/plug.kak"
    printf "%s\n" "source '$plugins/plug.kak/rc/plug.kak'"
}
plug "andreyorst/plug.kak" noload

plug "ftonneau/splash.kak"
plug 'casonadams/insert-indicator'
plug "andreyorst/fzf.kak"
plug "occivink/kakoune-sudo-write"
plug 'delapouite/kakoune-palette'

plug "evanrelf/byline.kak" config %{
  require-module "byline"
}

plug "lePerdu/kakboard" %{
    hook global WinCreate .* %{ kakboard-enable }
}

plug "alexherbo2/auto-pairs.kak" %{
    hook global WinCreate .* %{ enable-auto-pairs }
}


plug "andreyorst/kaktree" defer kaktree %{
    set-option global kaktree_double_click_duration '0.5'
    set-option global kaktree_indentation 1
    set-option global kaktree_dir_icon_open  '‚ñæ üóÅ '
    set-option global kaktree_dir_icon_close '‚ñ∏ üóÄ '
    set-option global kaktree_file_icon      '‚†Ä‚†Äüñ∫'
} config %{
    hook global WinSetOption filetype=kaktree %{
        remove-highlighter buffer/numbers
        remove-highlighter buffer/matching
        remove-highlighter buffer/wrap
        remove-highlighter buffer/show-whitespaces
    }
}

#plug "eburghar/kakship" do %{
#	cargo install --force --path . --root ~/.local
#	[ ! -e $kak_config/starship.toml ] && cp starship.toml $kak_config/
#} config %{
#	kakship-enable
#}

plug "andreyorst/langmap.kak" config %{
    # add needed extra layout, for example Russian '–π—Ü—É–∫–µ–Ω'
    set-option global langmap %opt{langmap_ru_jcuken}
} demand "langmap" %{
    # optional: mappings to toggle langmap
    map -docstring "toggle layout" global normal '<c-\>' ':      toggle-langmap<ret>'
    map -docstring "toggle layout" global insert '<c-\>' '<a-;>: toggle-langmap<ret>'
    map -docstring "toggle layout" global prompt '<c-\>' '<a-;>: toggle-langmap prompt<ret>'
}

#plug "evanrelf/number-toggle.kak" config %{
#  require-module "number-toggle"
#}

plug "andreyorst/powerline.kak" defer powerline %{
    powerline-format global 'git bufname filetype mode_info line_column position'
    powerline-toggle line_column off
} defer powerline_bufname %{
    set-option global powerline_shorten_bufname 'short'
} defer powerline_gruvbox %{

} config %{
    powerline-start
}

eval %sh{kak-lsp}
hook global WinSetOption filetype=(rust|python|go|javascript|typescript|c|cpp) %{
    lsp-enable-window
}




set-option global startup_info_version 99999999

set-option global indentwidth 4
set-option global tabstop 4
set-option global scrolloff 3,3
set-option global ui_options ncurses_assistant=cat

hook global WinCreate .* %{ try %{
    add-highlighter buffer/numbers  number-lines -hlcursor
    add-highlighter buffer/matching show-matching
    add-highlighter buffer/wrap     wrap -word -indent
    add-highlighter buffer/todo     regex \b(TODO|FIXME|XXX|NOTE)\b 0:default+rb
}}

hook global WinCreate ^[^*]+$ %{ git show-diff }
hook global BufWritePost ^[^*]+$ %{ git update-diff }


map global normal <c-p> ': fzf-mode<ret>'
map global normal <t> ': terminal nu<ret>'
